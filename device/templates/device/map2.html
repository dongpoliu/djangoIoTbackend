{% extends 'base.html' %}
{% load humanize %}
{% load i18n %}
{% load thumbs %}
{% load staticfiles %}
{% load remove_point from devices %}
{% load js from devices %}


{% block extracss  %} 
    <link href="{% static 'css/leaflet.css' %}" rel="stylesheet">
<style>
    .gmnoprint img {
        max-width: none;
    }

    .panel:hover {
        background-color: rgb(237, 245, 252);
    }

    .map {
        min-width: 600px;
        min-height: 600px;
        width: 100%;
        height: 100%;
    }

    img {
        max-width: 110%;
        height: auto;
    }

    .clearfix {
        clear: both;
    }

    .rowcolor {
        background-color: #CCCCCC;
    }

    .padall {
        padding: 10px;
    }

    .padbig {
        padding: 20px;
    }

    .icon {
        font-size: 23px;
        color: #197BB5;
    }
</style>
{% endblock extracss %}

{% block content %}

<div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 ">    
    <div class="row">
    {% for device in devices %}  
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
            <div class="panel panel-default" onclick="return init_map(0);">
                <div class="row padall">                
                    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
                        <span></span>                                                           
                        <img src="{{ device.thumbnail.url }}">
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
                        <div class="clearfix">
                            <div class="pull-left">
                                <span class="fa fa-dollar icon">{{device.name}}</span>
                            </div>
                            <div class="pull-right">
                                {{device.desc}}
                            </div>
                        </div>
                        <div>
                            <h4><span class="fa fa-map-marker icon"></span>{{ device.marker.geometry.x }}  and {{ device.marker.geometry.y }}</h4>
                            <span class="fa fa-lock icon pull-right">{{  device.get_lat_lon  }}</span>
                            {% with lat_lon=device.get_lat_lon %}
                                bar is {{ lat_lon }}
                           {% endwith %}
                        </div>                 
                    </div>
                </div>
            </div>
        </div>
           {% endfor %}
    </div>

</div>

<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <div class="row padbig">
        <div id="map" class="map">
        </div>
    </div>
</div>


{% endblock content %}

{% block extra_js %}
    <script src="{% static 'js/leaflet.js' %}"></script>
    <script type="text/javascript"> 
    var lat_lon  = {{ lat_lon | js   }};
    // create a map in the "map" div, set the view to a given place and zoom
    var map = L.map('map').setView(lat_lon, 13);
    
    // add an OpenStreetMap tile layer
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    // add a marker in the given location, attach some popup content to it and open the popup
    L.marker(lat_lon).addTo(map)
        .bindPopup('A pretty CSS3 popup. <br> Easily customizable.')
        .openPopup();  
    </script>
{% endblock extra_js%}











